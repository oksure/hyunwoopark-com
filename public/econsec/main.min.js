var n,e,r,t,o,s,a,c,i,u,l,d,f,p,g,h,m,x,v,y,w,k,O,b,P,z,C,q,A,L,S,j,B,E,I,M,T,D,F,H,J,N,G;b=s=L=d=r=G=F=O=P=E=e=f=N=D=M=T=i=I=null,u="#3366cc #dc3912 #ff9900 #109618 #990099 #0099c6 #dd4477 #66aa00 #b82e2e #316395 #994499 #22aa99 #aaaa11 #6633cc #e67300 #8b0707 #651067 #329262 #5574a6 #3b3eac".split(" "),J="https://www.dropbox.com/"===location.search.substr(1,24)?location.search.substr(1).replace("www.dropbox.com","dl.dropboxusercontent.com"):"https://dl.dropboxusercontent.com/s/o1z11zxmq1c6abx/export_2020.json?dl=0",g=function(){$("#last-updated").text(document.lastModified),h(),e=d3.scaleOrdinal().domain([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]).range(u),r=d3.drag().on("start",a).on("drag",o).on("end",t),G=d3.zoom().scaleExtent([.1,10]).on("zoom",function(){i.attr("transform",d3.event.transform)}),C(),$("#spinner").show(),d3.json(J).then(function(t){return d=t,b={},$.map(d.nodes,function(t){b[t.id]=[]}),$.map(d.links,function(t){b.hasOwnProperty(t.source)||(b[t.source]=[]),b.hasOwnProperty(t.target)||(b[t.target]=[]),b[t.source].push(t.target),b[t.target].push(t.source)}),E=d3.forceSimulation(d.nodes).force("charge",d3.forceManyBody().strength(-100)).force("collide",d3.forceCollide()).force("link",d3.forceLink(d.links).id(function(t){return t.id})).force("center",d3.forceCenter(N/2,f/2)).on("tick",H),(O=(O=M.selectAll(".link")).data(d.links,function(t){return t.source.id+"-"+t.target.id}).enter().append("line").attr("class","link").style("stroke-width",function(t){return t.hasOwnProperty("value")?t.value:1}).on("mouseover",function(t){B(t)}).on("mouseout",function(t){p()})).exit().remove(),(P=(P=T.selectAll(".node")).data(d.nodes,function(t){return t.id}).enter().append("circle").attr("class","node").attr("r",function(t){return t.hasOwnProperty("size")?t.size:6}).style("fill",function(t){return z(t)}).style("stroke",function(t){return z(t)}).call(r).on("mouseover",function(t){S(t,!0),B(t)}).on("mouseout",function(t){c(),p()}).on("click",function(t){if(d3.event.stopPropagation(),!d3.event.defaultPrevented)return n(t.x,t.y,l()[2],750)})).exit().remove(),(F=(F=D.selectAll(".text")).data(d.nodes,function(t){return t.id}).enter().append("text").attr("class","text").attr("dx",function(t){return t.hasOwnProperty("size")?t.size+4:10}).attr("dy",".35em").attr("font-size","9pt").text(function(t){return t.hasOwnProperty("label")?t.label:t.id}).call(r).on("mouseover",function(t){S(t,!0),B(t)}).on("mouseout",function(t){c(),p()}).on("click",function(t){if(d3.event.stopPropagation(),!d3.event.defaultPrevented)return n(t.x,t.y,l()[2],750)})).exit().remove(),I.call(G.transform,d3.zoomIdentity),$("#spinner").hide()})},H=function(){F.attr("transform",function(t){return"translate("+[t.x,t.y]+")"}),P.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),O.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y})},a=function(t){d3.event.active||E.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y,s=!0},o=function(t){t.fx=d3.event.x,t.fy=d3.event.y},t=function(t){d3.event.active||E.alphaTarget(1e-4),t.fx=null,t.fy=null,s=!1,c()},n=function(t,n,e,r){var o,s;s=[N/2-e*t,f/2-e*n],o=d3.zoomIdentity.translate(s[0],s[1]).scale(e),I.transition().duration(r).call(G.transform,o)},l=function(){return $("svg > g").attr("transform").match(/([\d\.]+)/g).map(parseFloat)},z=function(t){return t.hasOwnProperty("color")?t.color:t.hasOwnProperty("group")?e(t.group):e(1)},B=function(t){var n;(n=$("#tooltip")).html(JSON.stringify(t,["id","label","group","color","size","source","target","value","discontinuity","price"],2)),t.hasOwnProperty("x")?(n.css("left",10+t.x),n.css("top",10+t.y)):(n.css("left",10+(t.source.x+t.target.x)/2),n.css("top",10+(t.source.y+t.target.y)/2)),k()&&n.removeClass("d-none")},p=function(t){$("#tooltip").addClass("d-none")},h=function(){$(".nav-toggle").click(function(t){t.preventDefault(),"On"===this.text.split(": ")[1]?(i.selectAll("."+this.id.split("-")[1]).classed("d-none",!0),this.text=this.text.split(": ")[0]+": Off"):(i.selectAll("."+this.id.split("-")[1]).classed("d-none",!1),this.text=this.text.split(": ")[0]+": On"),$(this).blur()}),$("#quick-search").on("keyup search click",function(t){var n;L&&q(),0<(n=$("#quick-search").val()).length?j(n):c()}),$(".modal").on("shown.bs.modal",function(t){$(".nav-link").one("focus",function(t){return $(this).blur()})})},w=function(){return"On"===$("#toggle-text").text().split(": ")[1]},x=function(){return"On"===$("#toggle-link").text().split(": ")[1]},k=function(){return"On"===$("#toggle-tooltip").text().split(": ")[1]},v=function(t,n){return t.id===n.id||0<=b[n.id].indexOf(t.id)},y=function(t,n){var e,r;return e=0<=t.id.toString().toLowerCase().indexOf(n.toLowerCase()),r=!!t.hasOwnProperty("label")&&0<=t.label.toString().toLowerCase().indexOf(n.toLowerCase()),e||r},m=function(t,n){return t.source.id===n.id||t.target.id===n.id},S=function(n,t){null!==O&&(s||(O.classed("dim",function(t){return!m(t,n)}).classed("d-none",function(t){return!x()&&!m(t,n)}),P.classed("dim",function(t){return!v(t,n)}),F.classed("dim",function(t){return!v(t,n)}).classed("d-none",function(t){return!w()&&!v(t,n)})))},j=function(n){null!==O&&(O.classed("dim",!0).classed("d-none",function(t){return!x()}),P.classed("dim",function(t){return!y(t,n)}),F.classed("dim",function(t){return!y(t,n)}).classed("d-none",function(t){return!w()&&!y(t,n)}))},c=function(){null!==O&&(s||(L?L.hasOwnProperty("source")?setHighlightByEdge(L,!1):S(L,!1):0<$("#quick-search").val().length?j($("#quick-search").val()):(O.classed("dim",!1).classed("d-none",function(t){return!x()}).classed("selected",!1),P.classed("dim",!1).classed("selected",!1),F.classed("dim",!1).classed("d-none",function(t){return!w()}))))},q=function(){null!==O&&(L=null,c())},A=function(){N=$("#canvas").width(),f=$("#canvas").height()},C=function(){A(),$("#canvas").empty(),I=d3.select("#canvas").append("svg").attr("class","main-canvas").call(G),i=I.append("g"),M=i.append("g"),T=i.append("g"),D=i.append("g")},$(function(){g()});