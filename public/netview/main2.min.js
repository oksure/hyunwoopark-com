var n,t,e,o,r,s,i,a,c,u,l,d,f,p,g,h,m,x,v,y,k,w,O,b,F,P,z,C,q,A,L,S,j,B,E,I,M,T,D,H,J,N,G,K;b=s=L=d=e=K=H=O=F=E=t=f=G=D=M=T=c=I=null,u="#3366cc #dc3912 #ff9900 #109618 #990099 #0099c6 #dd4477 #66aa00 #b82e2e #316395 #994499 #22aa99 #aaaa11 #6633cc #e67300 #8b0707 #651067 #329262 #5574a6 #3b3eac".split(" "),N="https://www.dropbox.com/"===location.search.substr(1,24)?location.search.substr(1).replace("www.dropbox.com","dl.dropboxusercontent.com"):"https://dl.dropboxusercontent.com/s/vn98nq1g5fn6dkk/miserable.json?dl=0",g=function(){$("#last-updated").text(document.lastModified),h(),t=d3.scaleOrdinal().domain([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]).range(u),e=d3.drag().on("start",i).on("drag",r).on("end",o),K=d3.zoom().scaleExtent([.1,10]).on("zoom",function(){c.attr("transform",d3.event.transform)}),C(),$("#spinner").show(),d3.json(N).then(function(t){return d=t,b={},$.map(d.nodes,function(t){b[t.id]=[]}),$.map(d.links,function(t){b.hasOwnProperty(t.source)||(b[t.source]=[]),b.hasOwnProperty(t.target)||(b[t.target]=[]),b[t.source].push(t.target),b[t.target].push(t.source)}),E=d3.forceSimulation(d.nodes).force("charge",d3.forceManyBody().strength(-100)).force("collide",d3.forceCollide()).force("link",d3.forceLink(d.links).id(function(t){return t.id})).force("center",d3.forceCenter(G/2,f/2)).on("tick",J),(O=(O=M.selectAll(".link")).data(d.links,function(t){return t.source.id+"-"+t.target.id}).enter().append("line").attr("class","link").style("stroke-width",function(t){return t.hasOwnProperty("value")?t.value:1}).on("mouseover",function(t){B(t)}).on("mouseout",function(t){p()})).exit().remove(),(F=(F=T.selectAll(".node")).data(d.nodes,function(t){return t.id}).enter().append("circle").attr("class","node").attr("r",function(t){return t.hasOwnProperty("size")?t.size:6}).style("fill",function(t){return P(t)}).style("fill-opacity",1).style("stroke","#000000").style("stroke-opacity",1).style("stroke-width",function(t){return z(t)}).call(e).on("mouseover",function(t){S(t,!0),B(t)}).on("mouseout",function(t){a(),p()}).on("click",function(t){if(d3.event.stopPropagation(),!d3.event.defaultPrevented)return n(t.x,t.y,l()[2],750)})).exit().remove(),(H=(H=D.selectAll(".text")).data(d.nodes,function(t){return t.id}).enter().append("text").attr("class","text").attr("dx",function(t){return t.hasOwnProperty("size")?t.size+4:10}).attr("dy",".35em").attr("font-size","9pt").text(function(t){return t.hasOwnProperty("label")?t.label:t.id}).call(e).on("mouseover",function(t){S(t,!0),B(t)}).on("mouseout",function(t){a(),p()}).on("click",function(t){if(d3.event.stopPropagation(),!d3.event.defaultPrevented)return n(t.x,t.y,l()[2],750)})).exit().remove(),I.call(K.transform,d3.zoomIdentity),$("#spinner").hide()})},J=function(){H.attr("transform",function(t){return"translate("+[t.x,t.y]+")"}),F.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),O.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y})},i=function(t){d3.event.active||E.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y,s=!0},r=function(t){t.fx=d3.event.x,t.fy=d3.event.y},o=function(t){d3.event.active||E.alphaTarget(1e-4),t.fx=null,t.fy=null,s=!1,a()},n=function(t,n,e,o){var r,s;s=[G/2-e*t,f/2-e*n],r=d3.zoomIdentity.translate(s[0],s[1]).scale(e),I.transition().duration(o).call(K.transform,r)},l=function(){return $("svg > g").attr("transform").match(/([\d\.]+)/g).map(parseFloat)},P=function(t){return 0===t.group?"#FFFFFF":1===t.group?"#FFFFFF":2===t.group?"#7F7F7F":3===t.group?"#000000":void 0},z=function(t){return 0===t.group?5:1===t.group?1:0},B=function(t){var n;(n=$("#tooltip")).html(JSON.stringify(t,["id","label","group","color","size","source","target","value"],2)),t.hasOwnProperty("x")?(n.css("left",10+t.x),n.css("top",10+t.y)):(n.css("left",10+(t.source.x+t.target.x)/2),n.css("top",10+(t.source.y+t.target.y)/2)),w()&&n.removeClass("d-none")},p=function(t){$("#tooltip").addClass("d-none")},h=function(){$(".nav-toggle").click(function(t){t.preventDefault(),"On"===this.text.split(": ")[1]?(c.selectAll("."+this.id.split("-")[1]).classed("d-none",!0),this.text=this.text.split(": ")[0]+": Off"):(c.selectAll("."+this.id.split("-")[1]).classed("d-none",!1),this.text=this.text.split(": ")[0]+": On"),$(this).blur()}),$("#quick-search").on("keyup search click",function(t){var n;L&&q(),0<(n=$("#quick-search").val()).length?j(n):a()}),$(".modal").on("shown.bs.modal",function(t){$(".nav-link").one("focus",function(t){return $(this).blur()})})},k=function(){return"On"===$("#toggle-text").text().split(": ")[1]},x=function(){return"On"===$("#toggle-link").text().split(": ")[1]},w=function(){return"On"===$("#toggle-tooltip").text().split(": ")[1]},v=function(t,n){return t.id===n.id||0<=b[n.id].indexOf(t.id)},y=function(t,n){var e,o;return e=0<=t.id.toString().toLowerCase().indexOf(n.toLowerCase()),o=!!t.hasOwnProperty("label")&&0<=t.label.toString().toLowerCase().indexOf(n.toLowerCase()),e||o},m=function(t,n){return t.source.id===n.id||t.target.id===n.id},S=function(n,t){null!==O&&(s||(O.classed("dim",function(t){return!m(t,n)}).classed("d-none",function(t){return!x()&&!m(t,n)}),F.classed("dim",function(t){return!v(t,n)}),H.classed("dim",function(t){return!v(t,n)}).classed("d-none",function(t){return!k()&&!v(t,n)})))},j=function(n){null!==O&&(O.classed("dim",!0).classed("d-none",function(t){return!x()}),F.classed("dim",function(t){return!y(t,n)}),H.classed("dim",function(t){return!y(t,n)}).classed("d-none",function(t){return!k()&&!y(t,n)}))},a=function(){null!==O&&(s||(L?L.hasOwnProperty("source")?setHighlightByEdge(L,!1):S(L,!1):0<$("#quick-search").val().length?j($("#quick-search").val()):(O.classed("dim",!1).classed("d-none",function(t){return!x()}).classed("selected",!1),F.classed("dim",!1).classed("selected",!1),H.classed("dim",!1).classed("d-none",function(t){return!k()}))))},q=function(){null!==O&&(L=null,a())},A=function(){G=$("#canvas").width(),f=$("#canvas").height()},C=function(){A(),$("#canvas").empty(),I=d3.select("#canvas").append("svg").attr("class","main-canvas").call(K),c=I.append("g"),M=c.append("g"),T=c.append("g"),D=c.append("g")},$(function(){g()});